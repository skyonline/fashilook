/*125e8d5adbbf28d5532482bf1e4f6ef3d26ad396*/Ext.define("FashiLook.controller.LoginController",{extend:Ext.app.Controller,config:{refs:{mainView:"#MainView",btnSubmit:"#btnSubmit",btnCancel:"#btnCancel",txtEmail:"#txtEmail"},control:{btnSubmit:{tap:"onSubmit"},btnCancel:{tap:"onCancel"}}},emailValidator:/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,onSubmit:function(){var b=this;var a=this.getTxtEmail().getValue();if(this.emailValidator.test(a)){if(navigator.network&&navigator.network.connection&&navigator.network.connection.type!=Connection.NONE){loggedIn=true;Ext.select("#loggedAs span.loggedAsUserName").setHtml(a);this.getMainView().setActiveItem(1)}else{Ext.Msg.alert("Ошибка","Вход невозможен. Отсутствует подключение к интернету.")}}else{Ext.Msg.alert("Ошибка","Введен неверный логин.")}},onCancel:function(){this.getMainView().setActiveItem(1)}});Ext.define("FashiLook.controller.ProfileController",{extend:"Ext.app.Controller",config:{refs:{userData:"#user",userPhotos:"#userphotos",photoEntry:"#photoentry",mainView:"#MainView"}},loadData:function(a){var b=this;this.loadModel("FashiLook.model.UserEntryModel",a,function(d){var c=d.data;b.generateProfile.call(b,c)})},generateProfile:function(b){var a=this.getUserData();var d=this.getUserPhotos();var e=this.getPhotoEntry();var g=new Ext.Template('<div class="user-data"><img src="{Avatar}"/><h4>{Name}</h4></div>');a.setHtml(g.apply(b));d.setStore(Ext.create("Ext.data.Store",{model:"FashiLook.model.PhotoListItemModel"}));var h=d.getStore();var j=new Ext.Template('<div class="image-item" style="margin-top:{top}px;margin-left:{left}px;height:{height}px"><img src="{thumb}"></img></div>');var c=new Ext.Template('<img src="{Full}" class="photo-full"></img>');var f=[0,0,0];var i=(window.innerWidth>0)?window.innerWidth:screen.width;Ext.each(b.Photos,function(n,m){var k=parseInt(n.Height*(95/n.Width));var q=j.apply({left:8+(m%3)*(95+8),top:f[m%3],thumb:n.Thumb,height:k});h.add({Thumb:q});var p=Ext.create("Ext.Container",{scrollable:{direction:"vertical",directionLock:true},items:[{html:c.apply(n)},{xtype:"container",cls:"markerCarouselContainer"}]});var l=p.getAt(1);var o=(i/n.Width)*n.Height;Ext.each(n.Markers,function(s,r){var t,u;u=i*s.Dx;t=o*s.Dy;l.add({html:'<div class="markerWrapper" style="top:'+t+"px; left:"+u+'px;"><span class="marker"></span><label style="display:none">'+s.BrandName+"<br/>"+s.ClothingName+"</label></div>",listeners:[{element:"element",delegate:"span.marker",event:"tap",fn:function(y,w,v){var x=Ext.get(w).next();if(!x.hasCls("shown")){x.show();x.addCls("shown")}else{x.hide();x.removeCls("shown")}}}]})});e.insert(m,p);f[m%3]+=k+8});d.getAt(0).setStyle({height:Math.max(f[0],f[1],f[2])+10+"px"})},loadModel:function(b,c,a){if(navigator.network&&navigator.network.connection&&navigator.network.connection.type!=Connection.NONE){try{Ext.ModelMgr.getModel(b).load(c,{success:a,failure:function(){Ext.Msg.alert("Ошибка","Произошла ошибка загрузки данных. Повторите попытку позже.")}})}catch(d){Ext.Msg.alert("Ошибка","Ошибка загрузки данных. Повторите попытку позже.")}finally{}}}});Ext.define("FashiLook.controller.CreateController",{extend:"Ext.app.Controller",config:{refs:{newPhotoContainer:"#newPhotoContainer",markerContainer:"#markerContainer"}},getPhoto:function(){this.getMarkerContainer().removeAll(true,true);navigator.camera.getPicture(function(a){document.getElementById("newPhoto").src=a},this.onPhotoURIFail,{quality:50,destinationType:navigator.camera.DestinationType.FILE_URI,sourceType:navigator.camera.PictureSourceType.CAMERA})},onPhotoURIFail:function(a){alert("Failed because: "+a)},uploadPhoto:function(){var d=document.getElementById("newPhoto");var c=d.src;var e={Mx:[],My:[]};Ext.each(Ext.select("div.markerWrapper").elements,function(i,h,g){e.Mx.push(i.style.left.replace("px","")/d.width);e.My.push(i.style.top.replace("px","")/d.height)});var b=new FileUploadOptions();b.fileKey="file";b.fileName=c.substr(c.lastIndexOf("/")+1);var f=new FileTransfer();var a="http://fashilook.com/api/photoupload/1?"+Ext.urlEncode(e);f.upload(c,a,this.onUploadSuccess,this.onUploadFail,b)},onUploadSuccess:function(a){alert("Uploaded")},onUploadFail:function(a){alert("An error has occurred: Code = "+a.code+"\r\n upload error source "+a.source+"\r\n upload error target "+a.target)},setMarker:function(a){this.getMarkerContainer().add({html:'<div class="markerWrapper" style="top:'+(a.pageY-85-15+this.getNewPhotoContainer().getScrollable().getScroller().position.y)+"px; left:"+(a.pageX-10)+'px;"><span class="marker" ></span><label></label></div>',listeners:[{element:"element",delegate:"span.marker",event:"tap",fn:function(f,c,b){var d=Ext.get(c).next();if(!d.hasCls("shown")){d.show();d.addCls("shown")}else{d.hide();d.removeCls("shown")}}}]})}});Ext.define("FashiLook.view.Login",{extend:"Ext.Container",id:"LoginPanel",xtype:"login",requires:["Ext.TitleBar","Ext.form.FieldSet","Ext.field.Email","Ext.field.Password"],config:{layout:"vbox",scrollable:false,listeners:{deactivate:function(){this.destroy()}},items:[{xtype:"spacer",flex:1},{xtype:"container",flex:2,layout:"hbox",items:[{xtype:"spacer",flex:1},{xtype:"container",flex:10,layout:"vbox",id:"loginContainer",items:[{xtype:"spacer",flex:1},{flex:1,html:"<span>&nbsp</span>",id:"loginTitle"},{xtype:"spacer",flex:1},{xtype:"emailfield",flex:0.5,placeHolder:"example@example.com",name:"user",required:true,id:"txtEmail",height:"30%"},{xtype:"spacer",flex:1},{xtype:"button",flex:3,html:"<span>&nbsp</span>",id:"btnSubmit"},{xtype:"spacer",flex:1,html:"<div>&nbsp;</div>",id:"spaceLine"},{xtype:"button",flex:3,html:"<span>&nbsp</span>",id:"btnCancel"},]},{xtype:"spacer",flex:1}]},{xtype:"spacer",flex:1}]}});Ext.define("FashiLook.view.Favorites",{id:"FavoritesView",extend:"Ext.Container",xtype:"favorites",initialize:function(){this.callParent()},config:{html:"Favorites"}});Ext.define("FashiLook.view.Create",{id:"CreateView",extend:"Ext.Container",xtype:"create",initialize:function(){this.callParent()},config:{layout:"vbox",items:[{xtype:"container",id:"newPhotoContainer",flex:9,scrollable:true,items:[{html:'<img id="newPhoto" src="">',listeners:[{element:"element",delegate:"#newPhoto",event:"tap",fn:function(d,a,b){var c=FashiLook.app.getController("CreateController");c.setMarker(d)}}]},{id:"markerContainer"}]},{xtype:"toolbar",docked:"bottom",layout:{type:"hbox",align:"center",pack:"center"},flex:1,items:[{xtype:"button",id:"captureImageBtn",text:"Фото",flex:1,listeners:{tap:function(a){var b=FashiLook.app.getController("CreateController");b.getPhoto()}}},{xtype:"button",id:"uploadImageBtn",text:"Сохранить",flex:1,listeners:{tap:function(a){var b=FashiLook.app.getController("CreateController");b.uploadPhoto()}}}]}]}});Ext.define("FashiLook.view.Search",{id:"SearchView",extend:"Ext.Container",xtype:"search",initialize:function(){this.callParent()},config:{html:"Search"}});Ext.define("FashiLook.view.Ribbon",{id:"RibbonView",extend:"Ext.Container",xtype:"ribbon",requires:["Ext.data.Store"],initialize:function(){this.callParent();var a=FashiLook.app.getController("RibbonController");a.loadData()},config:{layout:"card",items:[{xtype:"list",id:"ribbonList",itemTpl:new Ext.XTemplate('<div class="judge-list-item"><tpl if="img"><img src="{img}"/></tpl><h4>{title}</h4><small>{description}</small></div>',{disableFormats:true}),scrollable:{direction:"vertical",directionLock:true},styleHtmlContent:true,listeners:{itemtap:function(e,b,f,a,c){var d=FashiLook.app.getController("RibbonController");d.onItemTap(e,b,f,a,c)}}},{xtype:"container",id:"ribbonDetails",scrollable:{direction:"vertical",directionLock:true},styleHtmlContent:true}]}});Ext.define("FashiLook.view.Info",{id:"InfoView",extend:"Ext.Container",xtype:"info",requires:["Ext.data.Store"],initialize:function(){this.callParent();var a=FashiLook.app.getController("InfoController");a.loadData()},config:{layout:"card",items:[{xtype:"list",id:"infoList",itemTpl:new Ext.XTemplate('<div class="judge-list-item"><tpl if="img"><img src="{img}"/></tpl><h4>{title}</h4><small>{description}</small></div>',{disableFormats:true}),scrollable:{direction:"vertical",directionLock:true},styleHtmlContent:true,listeners:{itemtap:function(e,b,f,a,c){var d=FashiLook.app.getController("InfoController");d.onItemTap(e,b,f,a,c)}}},{xtype:"container",id:"infoDetails",scrollable:{direction:"vertical",directionLock:true},styleHtmlContent:true}]}});Ext.define("FashiLook.model.ListModel",{extend:"Ext.data.Model",config:{fields:["id","pagetitle","description","img","content","data"],hasMany:{model:"FashiLook.model.ListItemModel",name:"data"},proxy:{type:"ajax",url:"http://fashilook.com/api/service/176",reader:{type:"json"}}}});Ext.define("FashiLook.model.ListItemModel",{extend:"Ext.data.Model",config:{fields:["id","title","description","img","content","leaf","list","thumb","price_club","price","time","trainer","day",{name:"start",type:"date",dateFormat:"c"},{name:"end",type:"date",dateFormat:"c"}],belongsTo:"FashiLook.model.ListModel",hasMany:{model:"FashiLook.model.ListItemModel",name:"list"}}});Ext.define("FashiLook.view.controls.Header",{id:"Header",extend:"Ext.Container",xtype:"header",config:{docked:"top",layout:"hbox",items:[{xtype:"button",cls:"no_bg",flex:2,html:"<span>&nbsp</span>",id:"backBtnH"},{html:"<span>&nbsp</span>",flex:5,id:"logo1"},{xtype:"button",html:"<span>&nbsp</span>",flex:2,id:"infoBtnH"}]}});Ext.define("FashiLook.view.controls.Footer",{id:"Footer",extend:"Ext.Container",xtype:"footer",config:{docked:"bottom",layout:"hbox",items:[{xtype:"button",flex:1,html:"<span>&nbsp</span>",id:"ribbonBtnF"},{xtype:"button",html:"<span>&nbsp</span>",flex:1,id:"searchBtnF"},{xtype:"button",html:"<span>&nbsp</span>",flex:1,id:"createBtnF"},{xtype:"button",flex:1,html:"<span>&nbsp</span>",id:"favoritesBtnF"},{xtype:"button",flex:1,html:"<span>&nbsp</span>",id:"profileBtnF"}]}});Ext.define("FashiLook.model.EntryModel",{extend:"Ext.data.Model",config:{fields:["id","title","headline","content"],proxy:{type:"ajax",url:"http://fashilook.com/api/service/176",reader:{type:"json"}}}});Ext.define("FashiLook.model.UserEntryModel",{extend:"Ext.data.Model",config:{fields:["Id","Name","Avatar","Photos"],hasMany:{model:"FashiLook.model.PhotoListItemModel",name:"Photos"},proxy:{type:"ajax",url:"http://fashilook.com/api/service/2",reader:{type:"json"}}}});Ext.define("FashiLook.model.PhotoListItemModel",{extend:"Ext.data.Model",config:{fields:["Id","Thumb","Full","Height","Width"],belongsTo:"FashiLook.model.UserEntryModel"}});Ext.define("FashiLook.view.MainContainer",{id:"MainContainer",extend:"Ext.Container",xtype:"maincontainer",requires:["FashiLook.view.controls.Header","FashiLook.view.controls.Footer"],config:{autoDestroy:true,listeners:{deactivate:function(a){a.removeAt(2)}},layout:"fit",items:[{xtype:"header"},{xtype:"footer"}]}});Ext.define("FashiLook.view.Main",{extend:"Ext.Container",fullscreen:true,requires:["FashiLook.view.Login","FashiLook.view.MainContainer"],id:"MainView",config:{layout:"card",items:[{xtype:"maincontainer"}]}});Ext.define("FashiLook.controller.ListBaseController",{extend:"Ext.app.Controller",requires:["FashiLook.model.EntryModel","FashiLook.model.ListModel","FashiLook.model.ListItemModel"],config:{refs:{listView:"",listViewContainer:"",backBtn:""}},listModelId:undefined,getDetailsCardContent:function(a){return a.data.content},buildStore:function(b,a){b.setStore(Ext.create("Ext.data.Store",{model:"FashiLook.model.ListItemModel",data:a}))},loadData:function(){var b=this.getListView();var c=this.listModelId;if(!c){throw"You should specify you model id in derrived class to retrive appropriate data from service!"}var a=this;this.loadModel("FashiLook.model.ListModel",c,function(d){a.buildStore(b,d.data.data)})},loadModel:function(b,d,a){if(navigator.network&&navigator.network.connection&&navigator.network.connection.type!=Connection.NONE){try{Ext.ModelMgr.getModel(b).load(d,{success:a,failure:function(){Ext.Msg.alert("Ошибка","Произошла ошибка загрузки данных. Повторите попытку позже.")}})}catch(c){Ext.Msg.alert("Ошибка","Ошибка загрузки данных. Повторите попытку позже.")}finally{}}},onItemTap:function(f,b,g,a,c){if(a.get("leaf")==true){var h=this.getListViewContainer();var e=a.get("id");var d=this;this.loadModel("FashiLook.model.EntryModel",e,function(i){h.getAt(1).setHtml(d.getDetailsCardContent(i));h.setActiveItem(1);d.getBackBtn().removeCls("no_bg")})}}});Ext.define("FashiLook.controller.RibbonController",{extend:"FashiLook.controller.ListBaseController",config:{refs:{listView:"#ribbonList",listViewContainer:"#RibbonView",backBtn:"#backBtnH"}},listModelId:174});Ext.define("FashiLook.controller.InfoController",{extend:"FashiLook.controller.ListBaseController",config:{refs:{listView:"#infoList",listViewContainer:"#InfoView",backBtn:"#backBtnH"}},listModelId:176});Ext.define("FashiLook.view.Profile",{id:"ProfileView",extend:"Ext.Container",xtype:"profile",requires:["FashiLook.model.UserEntryModel","FashiLook.model.PhotoListItemModel"],initialize:function(){var a=FashiLook.app.getController("ProfileController");a.loadData(1);this.callParent()},config:{layout:"card",items:[{xtype:"container",layout:"vbox",items:[{flex:2,xtype:"container",layout:"hbox",id:"profileheader",items:[{xtype:"container",id:"user",flex:5},{xtype:"container",flex:4,layout:"vbox",items:[{xtype:"container",layout:"hbox",flex:1,id:"useractions",items:[{xtype:"button",id:"clothesBtn",flex:3,text:"Одежда",listeners:{tap:function(){Ext.Msg.alert("Извините","Этот экшн в процессе разработки")}}},{xtype:"spacer",flex:1},{xtype:"button",id:"brandBtn",flex:3,text:"Брэнды",listeners:{tap:function(){Ext.Msg.alert("Извините","Этот экшн в процессе разработки")}}}]},{xtyle:"container",flex:2}]}]},{flex:5,xtype:"dataview",itemTpl:new Ext.XTemplate("{Thumb}"),id:"userphotos",listeners:{itemtap:function(b,c,e,a,d){this.parent.parent.getAt(1).setActiveItem(c);this.parent.parent.setActiveItem(1);Ext.get("backBtnH").removeCls("no_bg")}}}]},{xtype:"carousel",indicator:false,id:"photoentry",width:"100%",height:"100%"}],listeners:{deactivate:function(){this.destroy()}}}});Ext.define("FashiLook.controller.MainMenuController",{extend:Ext.app.Controller,requires:["FashiLook.view.Profile","FashiLook.view.Favorites","FashiLook.view.Create","FashiLook.view.Search","FashiLook.view.Ribbon","FashiLook.view.Info","FashiLook.model.ListModel","FashiLook.model.ListItemModel"],config:{refs:{mainContainer:"#MainContainer",btnFavoritesF:"#favoritesBtnF",btnProfileF:"#profileBtnF",btnCreateF:"#createBtnF",btnRibbonF:"#ribbonBtnF",btnSearchF:"#searchBtnF",btnInfoH:"#infoBtnH",btnBackH:"#backBtnH"},control:{btnFavoritesF:{tap:"onFavoritesF"},btnProfileF:{tap:"onProfileF"},btnCreateF:{tap:"onCreateF"},btnRibbonF:{tap:"onRibbonF"},btnSearchF:{tap:"onSearchF"},btnInfoH:{tap:"onInfoH"},btnBackH:{tap:"onBackH"}}},removeActiveCls:function(){Ext.select("#Footer div.x-layout-box-item, #Header div.x-layout-box-item").removeCls("active")},onInfoH:function(a){this.switchToInfo();this.getBtnBackH().addCls("no_bg")},onBackH:function(){var b=this.getMainContainer().getActiveItem();var a=b.getId();if(Ext.get(this.getBtnBackH().getId()).hasCls("no_bg")==false&&(a=="RibbonView"||a=="InfoView"||a=="ProfileView")){b.getAt(1).setHtml("");b.setActiveItem(0);this.getBtnBackH().addCls("no_bg")}},onFavoritesF:function(a){this.switchToFavorites();this.getBtnBackH().addCls("no_bg")},onCreateF:function(a){this.switchToCreate();this.getBtnBackH().addCls("no_bg")},onProfileF:function(a){this.switchToProfile();this.getBtnBackH().addCls("no_bg")},onRibbonF:function(){this.switchToRibbon();this.getBtnBackH().addCls("no_bg")},onSearchF:function(){this.switchToSearch();this.getBtnBackH().addCls("no_bg")},switchToInfo:function(){this.getMainContainer().removeAt(2);this.getMainContainer().add({xtype:"info"});this.removeActiveCls();this.getBtnInfoH().addCls("active")},switchToCreate:function(){this.getMainContainer().removeAt(2);this.getMainContainer().add({xtype:"create"});this.removeActiveCls();this.getBtnCreateF().addCls("active")},switchToFavorites:function(){this.getMainContainer().removeAt(2);this.getMainContainer().add({xtype:"favorites"});this.removeActiveCls();this.getBtnFavoritesF().addCls("active")},switchToProfile:function(){this.getMainContainer().removeAt(2);this.getMainContainer().add({xtype:"profile"});this.removeActiveCls();this.getBtnProfileF().addCls("active")},switchToRibbon:function(){this.getMainContainer().removeAt(2);this.getMainContainer().add({xtype:"ribbon"});this.removeActiveCls();this.getBtnRibbonF().addCls("active")},switchToSearch:function(){this.getMainContainer().removeAt(2);this.getMainContainer().add({xtype:"search"});this.removeActiveCls();this.getBtnSearchF().addCls("active")}});Ext.Loader.setPath({Ext:"sdk/src"});Ext.application({name:"FashiLook",isIconPrecomposed:true,views:["Main"],controllers:["RibbonController","InfoController","LoginController","MainMenuController","ProfileController","CreateController"],launch:function(){Ext.fly("appLoadingIndicator").destroy();if(navigator.network&&navigator.network.connection){if(navigator.network.connection.type==Connection.NONE){Ext.Msg.alert(GlobalMessages.ErrorTitle,GlobalMessages.NoInetOfflineMode)}else{var a=Ext.create("Ext.LoadMask",{message:GlobalMessages.LoadingData,id:"loading"});Ext.Viewport.add(a);a.hide();Ext.Ajax.on("beforerequest",function(){a.show()});Ext.Ajax.on("requestcomplete",function(){a.hide()});Ext.Ajax.on("requestexception",function(){a.hide()})}}Ext.Viewport.add(Ext.create("FashiLook.view.Main"))},onUpdated:function(){window.location.reload()}});var loggedIn=false;