/*71884ca5060406628359eea71abc23c516480d8f*/Ext.define("FashiLook.controller.LoginController",{extend:Ext.app.Controller,config:{refs:{mainView:"#MainView",btnRegister:"#btnRegister",btnSubmit:"#btnSubmit",txtEmail:"#txtEmail",txtPass:"#txtPass"}},emailValidator:/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,onSubmit:function(a){var c=this;var b=this.getTxtEmail().getValue();var d=this.getTxtPass().getValue();if(this.emailValidator.test(b)&&d){if(navigator.network&&navigator.network.connection&&navigator.network.connection.type!=Connection.NONE){Ext.Ajax.request({url:"http://fashilook.com/api/account",method:"POST",withCredentials:true,useDefaultXhrHeader:false,params:{Login:b,Password:d,IsNew:a},success:function(e){var g=parseInt(e.responseText);if(g>0){userId=g;var f=c.getMainView();f.add({xtype:"maincontainer"});c.getApplication().getController("MainMenuController").onRibbonF();f.setActiveItem(1)}else{Ext.Msg.alert("Ошибка","Неверный логин или пароль.")}},failure:function(e,f){Ext.Msg.alert("Ошибка","Вход невозможен. Ошибка подключения.")}})}else{Ext.Msg.alert("Ошибка","Вход невозможен. Отсутствует подключение к интернету.")}}else{Ext.Msg.alert("Ошибка","Введен неверный логин или пароль.")}},onCancel:function(){this.getMainView().setActiveItem(1)}});Ext.define("FashiLook.controller.CreateController",{extend:"Ext.app.Controller",config:{refs:{newPhotoContainer:"#newPhotoContainer",markerContainer:"#markerContainer"}},getPhoto:function(){this.getMarkerContainer().removeAll(true,true);navigator.camera.getPicture(function(a){document.getElementById("newPhoto").src=a},this.onPhotoURIFail,{quality:50,destinationType:navigator.camera.DestinationType.FILE_URI,sourceType:navigator.camera.PictureSourceType.CAMERA})},onPhotoURIFail:function(a){Ext.Msg.alert("Ошибка","Извините, возникли проблемы с камерой Вашего телефона.")},uploadPhoto:function(){var d=document.getElementById("newPhoto");var c=d.src;var e={Mx:[],My:[],BrandIds:[],ClothingIds:[],UserId:userId};Ext.each(Ext.getCmp("markerContainer").getItems().items,function(j,i,h){e.Mx.push(j.getLeft()/d.width);e.My.push(j.getTop()/d.height);e.ClothingIds.push(j.getAt(1).getValue());e.BrandIds.push(j.getAt(2).getValue())});var b=new FileUploadOptions();b.fileKey="file";b.fileName=c.substr(c.lastIndexOf("/")+1);var g=Ext.Viewport.getComponent("loading");if(g){g.show()}var f=new FileTransfer();var a="http://fashilook.com/api/photoupload/1/1?"+Ext.urlEncode(e);f.upload(c,a,this.onUploadSuccess,this.onUploadFail,b)},onUploadSuccess:function(a){var b=Ext.Viewport.getComponent("loading");if(b){b.hide()}Ext.Msg.alert("Успешная загрузка!","Ваша фотография была успешно загружена.")},onUploadFail:function(a){var b=Ext.Viewport.getComponent("loading");if(b){b.hide()}Ext.Msg.alert("Ошибка","Произошла ошибка загрузки фотографии.")},setMarker:function(b){var a=Ext.create("FashiLook.view.CreateMarker",{xtype:"createMarker",top:(b.pageY-75+this.getNewPhotoContainer().getScrollable().getScroller().position.y),left:(b.pageX-16)});this.getMarkerContainer().add(a);a.getAt(0).fireEvent("tap")}});Ext.define("FashiLook.view.Login",{extend:"Ext.Container",id:"LoginPanel",xtype:"login",requires:["Ext.TitleBar","Ext.form.FieldSet","Ext.field.Email","Ext.field.Password"],config:{layout:"vbox",scrollable:false,listeners:{deactivate:function(){this.destroy()}},padding:"65px 5px",items:[{xtype:"fieldset",title:"Вход",instructions:"Для регистрации введите логин, пароль и нажмите кнопку Регистрация",items:[{xtype:"emailfield",label:"Логин",placeHolder:"email@example.com",name:"email",required:true,id:"txtEmail"},{xtype:"passwordfield",label:"Пароль",placeHolder:"password",name:"password",required:true,id:"txtPass"}]},{xtype:"container",layout:"hbox",items:[{xtype:"button",text:"Вход",ui:"confirm",flex:1,id:"btnSubmit",listeners:{tap:function(){var a=FashiLook.app.getController("LoginController");a.onSubmit(false)}}},{xtype:"spacer",flex:1},{xtype:"button",text:"Регистрация",ui:"confirm",flex:1,id:"btnRegister",listeners:{tap:function(){var a=FashiLook.app.getController("LoginController");a.onSubmit(true)}}}]}]}});Ext.define("FashiLook.view.PhotoEntry",{extend:"Ext.Container",xtype:"photoentry",config:{scrollable:{direction:"vertical",directionLock:true},items:[{html:""},{xtype:"container",cls:"markerCarouselContainer"},{xtype:"hiddenfield",name:"photoId",value:0},{xtype:"hiddenfield",name:"Rank",value:0}]}});Ext.define("FashiLook.view.RateDialog",{extend:"Ext.MessageBox",xtype:"ratedialog",imageId:-1,config:{layout:"vbox",items:[{xtype:"toolbar",title:"Оценка",items:[{xtype:"button",iconMask:"true",iconCls:"reply",listeners:{tap:function(){this.getParent().getParent().hide()}}}]},{xtype:"toolbar",layout:{type:"hbox",align:"stretch",pack:"stretch"},padding:"10px",items:[getButtonCfg(1),{xtype:"spacer"},getButtonCfg(2),{xtype:"spacer"},getButtonCfg(3),{xtype:"spacer"},getButtonCfg(4),{xtype:"spacer"},getButtonCfg(5)]},{xtype:"toolbar",layout:{type:"hbox",align:"stretch",pack:"stretch"},padding:"10px",items:[getButtonCfg(6),{xtype:"spacer"},getButtonCfg(7),{xtype:"spacer"},getButtonCfg(8),{xtype:"spacer"},getButtonCfg(9),{xtype:"spacer"},getButtonCfg(10)]}]}});function getButtonCfg(a){return{xtype:"button",text:a,flex:1,width:"40px",hright:"50px",style:"z-index:999999;",listeners:{tap:function(){var b=this;Ext.Ajax.request({url:"http://fashilook.com/api/ratephoto/3",params:{rating:this.getText(),imageId:this.getParent().getParent().imageId},success:function(c){b.getParent().getParent().hide()}})}}}}Ext.define("FashiLook.view.Favorites",{id:"FavoritesView",extend:"Ext.Container",xtype:"favorites",requires:["Ext.data.Store"],initialize:function(){this.callParent();var a=FashiLook.app.getController("FavoritesController");a.loadData(7)},config:{layout:"card",items:[{flex:5,xtype:"dataview",itemTpl:new Ext.XTemplate("{Thumb}"),id:"favoritesPhotos",listeners:{itemtap:function(b,c,e,a,d){Ext.getCmp("favoritesEntry").setActiveItem(c);this.parent.setActiveItem(1);Ext.get("backBtnH").removeCls("no_bg")}}},{xtype:"container",layout:"vbox",items:[{xtype:"toolbar",docked:"top",items:[{xtype:"button",iconCls:"favorites",iconMask:true,listeners:{tap:function(){var a=Ext.create("FashiLook.view.RateDialog");a.imageId=Ext.getCmp("favoritesEntry").getActiveItem().getAt(2).getValue();a.show()}}},{xtype:"button",iconCls:"delete",iconMask:true,listeners:{tap:function(){FashiLook.app.getController("FavoritesController").removeFromFavorites(Ext.getCmp("favoritesEntry").getActiveItem().getAt(2).getValue())}}},{xtype:"spacer"},{html:"7.3",xtype:"container",id:"favoritesCurrentRating"}]},{xtype:"carousel",indicator:false,id:"favoritesEntry",listeners:{activeitemchange:function(e,d,a,b){var c=Ext.getCmp("favoritesCurrentRating");if(c){c.setHtml(d.getAt(3).getValue())}}},flex:1}]}],listeners:{deactivate:function(){var a=FashiLook.app.getController("FavoritesController");a.typeId=null;this.destroy()}}}});Ext.define("FashiLook.view.Info",{id:"InfoView",extend:"Ext.Container",xtype:"info",requires:["Ext.data.Store"],initialize:function(){this.callParent();var a=FashiLook.app.getController("InfoController");a.loadData()},config:{layout:"card",items:[{xtype:"list",id:"infoList",itemTpl:new Ext.XTemplate('<div class="judge-list-item"><tpl if="img"><img src="{img}"/></tpl><p>{title}</p><small>{description}</small></div>',{disableFormats:true}),scrollable:{direction:"vertical",directionLock:true},styleHtmlContent:true,listeners:{itemtap:function(e,b,f,a,c){var d=FashiLook.app.getController("InfoController");d.onItemTap(e,b,f,a,c)}}},{xtype:"container",id:"infoDetails",scrollable:{direction:"vertical",directionLock:true},styleHtmlContent:true}]}});Ext.define("FashiLook.model.ListModel",{extend:"Ext.data.Model",config:{fields:["id","pagetitle","description","img","content","data"],hasMany:{model:"FashiLook.model.ListItemModel",name:"data"},proxy:{type:"ajax",url:"http://fashilook.com/api/service/176",reader:{type:"json"}}}});Ext.define("FashiLook.model.ListItemModel",{extend:"Ext.data.Model",config:{fields:["id","title","description","img","content","leaf","list","thumb","price_club","price","time","trainer","day",{name:"start",type:"date",dateFormat:"c"},{name:"end",type:"date",dateFormat:"c"}],belongsTo:"FashiLook.model.ListModel",hasMany:{model:"FashiLook.model.ListItemModel",name:"list"}}});Ext.define("FashiLook.model.FavoritesPhotosModel",{extend:"Ext.data.Model",config:{fields:["Id","Name","Avatar","Photos"],hasMany:{model:"FashiLook.model.PhotoListItemModel",name:"Photos"},proxy:{type:"ajax",url:"http://fashilook.com/api/service/7",reader:{type:"json"}}}});Ext.define("FashiLook.view.controls.Header",{id:"Header",extend:"Ext.Container",xtype:"header",config:{docked:"top",layout:"hbox",items:[{xtype:"button",cls:"no_bg",flex:2,html:"<span>&nbsp</span>",id:"backBtnH"},{html:'<img src="resources/images/logo.png" style="height: 68px;"/>',flex:5,id:"logo1"},{xtype:"button",html:"<span>&nbsp</span>",flex:2,id:"infoBtnH"}]}});Ext.define("FashiLook.view.controls.Footer",{id:"Footer",extend:"Ext.Container",xtype:"footer",config:{docked:"bottom",layout:"hbox",items:[{xtype:"button",flex:1,html:"<span>&nbsp</span>",id:"ribbonBtnF"},{xtype:"button",html:"<span>&nbsp</span>",flex:1,id:"searchBtnF"},{xtype:"button",html:"<span>&nbsp</span>",flex:1,id:"createBtnF"},{xtype:"button",flex:1,html:"<span>&nbsp</span>",id:"favoritesBtnF"},{xtype:"button",flex:1,html:"<span>&nbsp</span>",id:"profileBtnF"}]}});Ext.define("FashiLook.model.EntryModel",{extend:"Ext.data.Model",config:{fields:["id","title","headline","content"],proxy:{type:"ajax",url:"http://fashilook.com/api/service/",reader:{type:"json"}}}});Ext.define("FashiLook.model.UserEntryModel",{extend:"Ext.data.Model",config:{fields:["Id","Name","Avatar","Photos"],hasMany:{model:"FashiLook.model.PhotoListItemModel",name:"Photos"},proxy:{type:"ajax",url:"http://fashilook.com/api/service/2",reader:{type:"json"}}}});Ext.define("FashiLook.model.PhotoListItemModel",{extend:"Ext.data.Model",config:{fields:["Id","Thumb","Full","Height","Width"],belongsTo:"FashiLook.model.UserEntryModel"}});Ext.define("FashiLook.model.LookupModel",{extend:"Ext.data.Model",config:{fields:[{name:"text",mapping:"Name"},{name:"value",mapping:"Id"}]}});Ext.define("FashiLook.model.SearchListItemModel",{extend:"Ext.data.Model",config:{fields:["Id","Name","type"],belongsTo:"FashiLook.model.SearchListModel"}});Ext.define("FashiLook.model.SearchListModel",{extend:"Ext.data.Model",config:{fields:["Clothes","Brands"],hasMany:[{model:"FashiLook.model.SearchListItemModel",name:"Clothes"},{model:"FashiLook.model.SearchListItemModel",name:"Brands"}],proxy:{type:"ajax",url:"http://fashilook.com/api/service/4",reader:{type:"json"}}}});Ext.define("FashiLook.model.RibbonListModel",{extend:"Ext.data.Model",config:{fields:["Photos"],hasMany:{model:"FashiLook.model.PhotoListItemModel",name:"Photos"},proxy:{type:"ajax",url:"http://fashilook.com/api/service/5",reader:{type:"json"}}}});Ext.define("FashiLook.view.MainContainer",{id:"MainContainer",extend:"Ext.Container",xtype:"maincontainer",requires:["FashiLook.view.controls.Header","FashiLook.view.controls.Footer"],config:{autoDestroy:true,listeners:{deactivate:function(a){a.removeAt(2)}},layout:"fit",items:[{xtype:"header"},{xtype:"footer"}]}});Ext.define("FashiLook.view.Main",{extend:"Ext.Container",fullscreen:true,requires:["FashiLook.view.Login","FashiLook.view.MainContainer"],id:"MainView",config:{layout:"card",items:[{xtype:"login"}]}});Ext.define("FashiLook.controller.TileControllerBase",{extend:"Ext.app.Controller",requires:"FashiLook.view.PhotoEntry",config:{refs:{tileDataView:"",tileCarousel:"",mainView:"#MainView"}},typeId:null,modelName:"FashiLook.model.UserEntryModel",loadData:function(a){var b=this;this.loadModel(this.modelName,this.typeId,function(d){var c=d.data;b.buildTiles.call(b,c)})},prebuildTiles:function(a){},buildTiles:function(d){this.prebuildTiles(d);var a=this.getTileDataView();var g=this.getTileCarousel();a.setStore(Ext.create("Ext.data.Store",{model:"FashiLook.model.PhotoListItemModel"}));var b=a.getStore();var h=new Ext.Template('<div class="image-item" style="margin-top:{top}px;margin-left:{left}px;height:{height}px"><img src="{thumb}" onload="this.style.opacity=1;"></img></div>');var c=new Ext.Template('<img src="{Full}" class="photo-full"></img>');var f=[0,0,0];var e=(window.innerWidth>0)?window.innerWidth:screen.width;Ext.each(d.Photos,function(l,k){var i=parseInt(l.Height*(95/l.Width));var o=h.apply({left:8+(k%3)*(95+8),top:f[k%3],thumb:l.Thumb,height:i});b.add({Thumb:o});var n=Ext.create("FashiLook.view.PhotoEntry");n.getAt(0).setHtml(c.apply(l));n.getAt(2).setValue(l.Id);n.getAt(3).setValue(l.Rank);var j=n.getAt(1);var m=(e/l.Width)*l.Height;Ext.each(l.Markers,function(q,p){var r,s;s=e*q.Dx;r=m*q.Dy;j.add({html:'<div class="markerWrapper" style="top:'+r+"px; left:"+s+'px;"><span class="marker"></span><label style="display:none">'+q.BrandName+"<br/>"+q.ClothingName+"</label></div>",listeners:[{element:"element",delegate:"span.marker",event:"tap",fn:function(w,u,t){var v=Ext.get(u).next();if(!v.hasCls("shown")){v.show();v.addCls("shown")}else{v.hide();v.removeCls("shown")}}}]})});g.insert(k,n);f[k%3]+=i+8});a.getAt(0).setStyle({height:Math.max(f[0],f[1],f[2])+10+"px"})},loadModel:function(b,c,a){if(navigator.network&&navigator.network.connection&&navigator.network.connection.type!=Connection.NONE){try{Ext.ModelMgr.getModel(b).load(c,{success:a,failure:function(){Ext.Msg.alert("Ошибка","Произошла ошибка загрузки данных. Повторите попытку позже.")}})}catch(d){Ext.Msg.alert("Ошибка","Ошибка загрузки данных. Повторите попытку позже.")}finally{}}}});Ext.define("FashiLook.controller.RibbonController",{extend:"FashiLook.controller.TileControllerBase",requires:"FashiLook.view.PhotoEntry",config:{refs:{tileDataView:"#ribbonPhotos",tileCarousel:"#ribbonEntry"}},modelName:"FashiLook.model.RibbonListModel",addToFavorites:function(a){if(navigator.network&&navigator.network.connection&&navigator.network.connection.type!=Connection.NONE){Ext.Ajax.request({url:"http://fashilook.com/api/service/6/"+a,method:"POST",success:function(b){Ext.Msg.alert(GlobalMessages.InfoTitle,"Закладка добавлена.")}})}}});Ext.define("FashiLook.controller.ProfileController",{extend:"FashiLook.controller.TileControllerBase",config:{refs:{userData:"#user",tileDataView:"#userphotos",tileCarousel:"#photoentry"}},prebuildTiles:function(c){var a=this.getUserData();var b=new Ext.Template('<div class="user-data"><img src="{Avatar}"/><h4>{Name}</h4></div>');a.setHtml(b.apply(c))}});Ext.define("FashiLook.controller.FavoritesController",{extend:"FashiLook.controller.TileControllerBase",requires:["FashiLook.view.PhotoEntry","FashiLook.model.FavoritesPhotosModel"],config:{refs:{tileDataView:"#favoritesPhotos",tileCarousel:"#favoritesEntry"}},modelName:"FashiLook.model.FavoritesPhotosModel",removeFromFavorites:function(a){if(navigator.network&&navigator.network.connection&&navigator.network.connection.type!=Connection.NONE){Ext.Ajax.request({url:"http://fashilook.com/api/service/8/"+a,method:"POST",success:function(b){Ext.Msg.alert(GlobalMessages.InfoTitle,"Закладка удалена.");FashiLook.app.getController("MainMenuController").onBackH()}})}}});Ext.define("FashiLook.controller.ListBaseController",{extend:"Ext.app.Controller",requires:["FashiLook.model.EntryModel","FashiLook.model.ListModel","FashiLook.model.ListItemModel"],config:{refs:{listView:"",listViewContainer:"",backBtn:""}},listModelId:undefined,getDetailsCardContent:function(a){return a.data.content},buildStore:function(b,a){b.setStore(Ext.create("Ext.data.Store",{model:"FashiLook.model.ListItemModel",data:a}))},loadData:function(){var b=this.getListView();var c=this.listModelId;if(!c){throw"You should specify you model id in derrived class to retrive appropriate data from service!"}var a=this;this.loadModel("FashiLook.model.ListModel",c,function(d){a.buildStore(b,d.data.data)})},loadModel:function(b,d,a){if(navigator.network&&navigator.network.connection&&navigator.network.connection.type!=Connection.NONE){try{Ext.ModelMgr.getModel(b).load(d,{success:a,failure:function(){Ext.Msg.alert("Ошибка","Произошла ошибка загрузки данных. Повторите попытку позже.")}})}catch(c){Ext.Msg.alert("Ошибка","Ошибка загрузки данных. Повторите попытку позже.")}finally{}}},onItemTap:function(f,b,g,a,c){if(a.get("leaf")==true){var h=this.getListViewContainer();var e=a.get("id");var d=this;this.loadModel("FashiLook.model.EntryModel",e,function(i){h.getAt(1).setHtml(d.getDetailsCardContent(i));h.setActiveItem(1);d.getBackBtn().removeCls("no_bg")})}}});Ext.define("FashiLook.controller.InfoController",{extend:"FashiLook.controller.ListBaseController",config:{refs:{listView:"#infoList",listViewContainer:"#InfoView",backBtn:"#backBtnH"}},listModelId:176});Ext.define("FashiLook.controller.SearchController",{extend:"FashiLook.controller.ListBaseController",config:{refs:{listView:"#searchItems",listViewContainer:"#SearchView",backBtn:"#backBtnH"}},listModelId:4,loadData:function(a){var b=this.getListView();this.loadModel("FashiLook.model.SearchListModel",a,function(d){var c=[];Ext.each(d.data.Clothes,function(f,e,g){g[e].type=1;c.push(g[e])});Ext.each(d.data.Brands,function(f,e,g){g[e].type=2;c.push(g[e])});b.setStore(Ext.create("Ext.data.Store",{model:"FashiLook.model.SearchListItemModel",filters:[{property:"type",value:2}],data:c}))})},filterData:function(a){this.getListView().getStore().clearFilter();this.getListView().getStore().filter("type",a)}});Ext.define("FashiLook.view.Profile",{id:"ProfileView",extend:"Ext.Container",xtype:"profile",requires:["FashiLook.model.UserEntryModel","FashiLook.model.PhotoListItemModel"],initialize:function(){var a=FashiLook.app.getController("ProfileController");a.loadData(1);this.callParent()},config:{layout:"card",items:[{xtype:"container",layout:"vbox",items:[{flex:1.5,xtype:"container",layout:"hbox",id:"profileheader",padding:"5px",items:[{xtype:"container",id:"user",flex:4}]},{flex:7,xtype:"dataview",itemTpl:new Ext.XTemplate("{Thumb}"),id:"userphotos",listeners:{itemtap:function(b,c,e,a,d){this.parent.parent.getAt(1).setActiveItem(c);this.parent.parent.setActiveItem(1);Ext.get("backBtnH").removeCls("no_bg")}}}]},{xtype:"carousel",indicator:false,id:"photoentry",width:"100%",height:"100%"}],listeners:{deactivate:function(){this.destroy()}}}});Ext.define("FashiLook.view.Create",{id:"CreateView",extend:"Ext.Container",xtype:"create",requires:"FashiLook.model.LookupModel",initialize:function(){this.callParent()},config:{layout:"vbox",items:[{xtype:"container",id:"newPhotoContainer",flex:9,scrollable:true,items:[{html:'<img id="newPhoto" src="">',listeners:[{element:"element",delegate:"#newPhoto",event:"tap",fn:function(d,a,b){var c=FashiLook.app.getController("CreateController");c.setMarker(d)}}]},{id:"markerContainer"}]},{xtype:"toolbar",docked:"bottom",layout:{type:"hbox",align:"center",pack:"center"},flex:1,items:[{xtype:"button",id:"captureImageBtn",text:"Фото",flex:1,listeners:{tap:function(a){var b=FashiLook.app.getController("CreateController");b.getPhoto()}}},{xtype:"button",id:"uploadImageBtn",text:"Сохранить",flex:1,listeners:{tap:function(a){var b=FashiLook.app.getController("CreateController");b.uploadPhoto()}}}]}]}});Ext.define("FashiLook.view.CreateMarker",{extend:"Ext.Container",xtype:"createMarker",config:{cls:"markerEditor",items:[{xtype:"button",ui:"round",width:20,height:32,cls:"marker",listeners:{tap:function(){var a=Ext.create("FashiLook.view.CreateMarkerEditor");a.markerRef=this.getParent();a.getAt(1).getAt(0).getStore().load(function(){var b=this.getParent().getAt(1).getValue();if(b){a.getAt(1).getAt(0).setValue(b)}},this);a.getAt(1).getAt(1).getStore().load(function(){var b=this.getParent().getAt(2).getValue();if(b){a.getAt(1).getAt(1).setValue(b)}},this);a.show()}}},{xtype:"hiddenfield",name:"clothing"},{xtype:"hiddenfield",name:"brand"}]}});Ext.define("FashiLook.view.CreateMarkerEditor",{extend:"Ext.MessageBox",xtype:"createMarkerEditor",config:{layout:"vbox",items:[{xtype:"toolbar",title:"Метка",items:[{xtype:"button",iconCls:"reply",iconMask:"true",listeners:{tap:function(){var a=this.getParent().getParent();a.markerRef.getAt(1).setValue(a.getAt(1).getAt(0).getValue());a.markerRef.getAt(2).setValue(a.getAt(1).getAt(1).getValue());a.hide()}}},{xtype:"spacer"},{xtype:"button",iconCls:"delete",iconMask:"true",listeners:{tap:function(){this.getParent().getParent().markerRef.destroy();this.getParent().getParent().hide()}}}]},{xtype:"fieldset",items:[{xtype:"selectfield",store:{model:"FashiLook.model.LookupModel",proxy:{type:"ajax",url:"http://fashilook.com/api/service/4/4",reader:{type:"json",rootProperty:"Clothes"}}}},{xtype:"selectfield",store:{model:"FashiLook.model.LookupModel",proxy:{type:"ajax",url:"http://fashilook.com/api/service/4/4",reader:{type:"json",rootProperty:"Brands"}}}}]}]},markerRef:null});Ext.define("FashiLook.view.Search",{id:"SearchView",extend:"Ext.Container",requires:["FashiLook.model.SearchListItemModel","FashiLook.model.SearchListModel"],xtype:"search",initialize:function(){this.callParent();var a=FashiLook.app.getController("SearchController");a.loadData(1)},config:{layout:"vbox",listeners:{deactivate:function(){this.destroy()}},items:[{xtype:"container",flex:1,layout:"hbox",items:[{xtype:"spacer",flex:1},{xtype:"segmentedbutton",allowMultiple:false,flex:2,items:[{text:"Брэнды",pressed:true,type:2},{text:"Одежда",type:1}],listeners:{toggle:function(a,b,d){var c=FashiLook.app.getController("SearchController");c.filterData(b.config.type)}}},{xtype:"spacer",flex:1}]},{xtype:"list",id:"searchItems",flex:9,itemTpl:'<div class="judge-list-item"><p>{Name}</p></div>',scrollable:{direction:"vertical",directionLock:true},listeners:{itemtap:function(f,b,g,a,c){var e=FashiLook.app.getController("RibbonController");var d=a.get("type");e.typeId=d+""+a.get("Id");FashiLook.app.getController("MainMenuController").onRibbonF()}}}]}});Ext.define("FashiLook.view.Ribbon",{id:"RibbonView",extend:"Ext.Container",xtype:"ribbon",requires:["Ext.data.Store","FashiLook.model.RibbonListModel","FashiLook.model.PhotoListItemModel"],initialize:function(){this.callParent();var a=FashiLook.app.getController("RibbonController");a.loadData(2)},config:{layout:"card",items:[{flex:5,xtype:"dataview",itemTpl:new Ext.XTemplate("{Thumb}"),id:"ribbonPhotos",listeners:{itemtap:function(b,c,e,a,d){Ext.getCmp("ribbonEntry").setActiveItem(c);this.parent.setActiveItem(1);Ext.get("backBtnH").removeCls("no_bg")}}},{xtype:"container",layout:"vbox",items:[{xtype:"toolbar",docked:"top",items:[{xtype:"button",iconCls:"favorites",iconMask:true,listeners:{tap:function(){var a=Ext.create("FashiLook.view.RateDialog");a.imageId=Ext.getCmp("ribbonEntry").getActiveItem().getAt(2).getValue();a.show()}}},{xtype:"button",iconCls:"add",iconMask:true,listeners:{tap:function(){FashiLook.app.getController("RibbonController").addToFavorites(Ext.getCmp("ribbonEntry").getActiveItem().getAt(2).getValue())}}},{xtype:"spacer"},{html:"7.3",xtype:"container",id:"ribbonCurrentRating"}]},{xtype:"carousel",indicator:false,id:"ribbonEntry",listeners:{activeitemchange:function(e,d,a,b){var c=Ext.getCmp("ribbonCurrentRating");if(c){c.setHtml(d.getAt(3).getValue())}}},flex:1}]}],listeners:{deactivate:function(){var a=FashiLook.app.getController("RibbonController");a.typeId=null;this.destroy()}}}});Ext.define("FashiLook.controller.MainMenuController",{extend:Ext.app.Controller,requires:["FashiLook.view.Profile","FashiLook.view.Favorites","FashiLook.view.Create","FashiLook.view.Search","FashiLook.view.Ribbon","FashiLook.view.Info","FashiLook.model.ListModel","FashiLook.model.ListItemModel"],config:{refs:{mainContainer:"#MainContainer",btnFavoritesF:"#favoritesBtnF",btnProfileF:"#profileBtnF",btnCreateF:"#createBtnF",btnRibbonF:"#ribbonBtnF",btnSearchF:"#searchBtnF",btnInfoH:"#infoBtnH",btnBackH:"#backBtnH"},control:{btnFavoritesF:{tap:"onFavoritesF"},btnProfileF:{tap:"onProfileF"},btnCreateF:{tap:"onCreateF"},btnRibbonF:{tap:"onRibbonF"},btnSearchF:{tap:"onSearchF"},btnInfoH:{tap:"onInfoH"},btnBackH:{tap:"onBackH"}}},removeActiveCls:function(){Ext.select("#Footer div.x-layout-box-item, #Header div.x-layout-box-item").removeCls("active")},onInfoH:function(a){this.switchToInfo();this.getBtnBackH().addCls("no_bg")},onBackH:function(){var b=this.getMainContainer().getActiveItem();var a=b.getId();if(Ext.get(this.getBtnBackH().getId()).hasCls("no_bg")==false&&(a=="RibbonView"||a=="InfoView"||a=="ProfileView"||a=="FavoritesView")){b.getAt(1).setHtml("");b.setActiveItem(0);this.getBtnBackH().addCls("no_bg")}},onFavoritesF:function(a){this.switchToFavorites();this.getBtnBackH().addCls("no_bg")},onCreateF:function(a){this.switchToCreate();this.getBtnBackH().addCls("no_bg")},onProfileF:function(a){this.switchToProfile();this.getBtnBackH().addCls("no_bg")},onRibbonF:function(b){if(b){var a=FashiLook.app.getController("RibbonController");a.typeId=null}this.switchToRibbon();this.getBtnBackH().addCls("no_bg")},onSearchF:function(){this.switchToSearch();this.getBtnBackH().addCls("no_bg")},switchToInfo:function(){this.getMainContainer().removeAt(2);this.getMainContainer().add({xtype:"info"});this.removeActiveCls();this.getBtnInfoH().addCls("active")},switchToCreate:function(){this.getMainContainer().removeAt(2);this.getMainContainer().add({xtype:"create"});this.removeActiveCls();this.getBtnCreateF().addCls("active")},switchToFavorites:function(){this.getMainContainer().removeAt(2);this.getMainContainer().add({xtype:"favorites"});this.removeActiveCls();this.getBtnFavoritesF().addCls("active")},switchToProfile:function(){this.getMainContainer().removeAt(2);this.getMainContainer().add({xtype:"profile"});this.removeActiveCls();this.getBtnProfileF().addCls("active")},switchToRibbon:function(){this.getMainContainer().removeAt(2);this.getMainContainer().add({xtype:"ribbon"});this.removeActiveCls();this.getBtnRibbonF().addCls("active")},switchToSearch:function(){this.getMainContainer().removeAt(2);this.getMainContainer().add({xtype:"search"});this.removeActiveCls();this.getBtnSearchF().addCls("active")}});Ext.Loader.setPath({Ext:"sdk/src"});Ext.application({name:"FashiLook",isIconPrecomposed:true,views:["Main"],controllers:["RibbonController","InfoController","LoginController","MainMenuController","ProfileController","CreateController","SearchController","FavoritesController"],launch:function(){Ext.fly("appLoadingIndicator").destroy();if(navigator.network&&navigator.network.connection){if(navigator.network.connection.type==Connection.NONE){Ext.Msg.alert(GlobalMessages.ErrorTitle,GlobalMessages.NoInetOfflineMode)}else{var a=Ext.create("Ext.LoadMask",{message:GlobalMessages.LoadingData,id:"loading"});Ext.Viewport.add(a);a.hide();Ext.Ajax.on("beforerequest",function(){a.show()});Ext.Ajax.on("requestcomplete",function(){a.hide()});Ext.Ajax.on("requestexception",function(){a.hide()})}}Ext.Viewport.add(Ext.create("FashiLook.view.Main"))},onUpdated:function(){window.location.reload()}});var userId=-1;